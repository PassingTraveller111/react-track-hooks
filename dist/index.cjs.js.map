{"version":3,"file":"index.cjs.js","sources":["../src/types.ts","../src/trackHooks.ts"],"sourcesContent":["// src/types.ts\nexport enum TrackType {\n    CLICK = 'click',\n    EXPOSURE = 'exposure',\n    PAGE_STAY = 'page_stay',\n    CUSTOM = 'custom'\n}\n\nexport interface TrackParams {\n    eventName: string;\n    type: TrackType;\n    [key: string]: any;\n}\n\n// 新增：全局配置类型\nexport interface TrackGlobalConfig {\n    // 埋点上报接口 URL\n    trackUrl: string;\n    // 是否开启埋点\n    enable?: boolean;\n    // 重试配置\n    retryConfig?: {\n        maxRetryTimes: number;\n        initialDelay: number;\n        delayMultiplier: number;\n    };\n}\n\n// 调整：TrackConfig 继承并扩展全局配置，支持单个 Hook 覆盖\nexport interface TrackConfig extends Partial<TrackGlobalConfig> {\n    exposureOnce?: boolean;\n    exposureThreshold?: number;\n}\n\nexport interface FailedTrackParams extends TrackParams {\n    retryTime: number;\n    retryCount?: number;\n}","// src/trackHooks.ts\nimport { useEffect, useRef, useCallback } from 'react';\nimport { TrackType, TrackParams, TrackConfig, TrackGlobalConfig, FailedTrackParams } from './types';\n\n// 全局配置（默认值），并提供修改全局配置的方法\nlet GLOBAL_TRACK_CONFIG: TrackGlobalConfig = {\n    trackUrl: '/api/track', // 默认上报地址\n    enable: true,\n    retryConfig: {\n        maxRetryTimes: 3,\n        initialDelay: 1000,\n        delayMultiplier: 2\n    }\n};\n\n/**\n * 设置全局埋点配置（项目初始化时调用一次即可）\n * @param config 全局配置\n */\nexport const setTrackGlobalConfig = (config: Partial<TrackGlobalConfig>) => {\n    GLOBAL_TRACK_CONFIG = { ...GLOBAL_TRACK_CONFIG, ...config };\n};\n\n// 2. 调整默认配置，合并全局配置\nconst getMergedDefaultConfig = (): TrackConfig => ({\n    exposureOnce: true,\n    exposureThreshold: 0.5,\n    ...GLOBAL_TRACK_CONFIG // 继承全局配置（trackUrl、enable、retryConfig）\n});\n\n// ---------------------- 埋点发送 & 重试核心逻辑 ----------------------\nexport const getFailedTracks = (): FailedTrackParams[] => {\n    try {\n        return JSON.parse(localStorage.getItem('failedTracks') || '[]');\n    } catch (error) {\n        console.error('读取失败埋点数据失败：', error);\n        return [];\n    }\n};\n\nexport const saveFailedTracks = (tracks: FailedTrackParams[]) => {\n    try {\n        localStorage.setItem('failedTracks', JSON.stringify(tracks));\n    } catch (error) {\n        console.error('保存失败埋点数据失败：', error);\n    }\n};\n\n/**\n * 重试失败的埋点（使用全局配置的 trackUrl）\n */\nexport const retryFailedTracks = async (force = false) => {\n    const failedTracks = getFailedTracks();\n    if (failedTracks.length === 0) return;\n\n    const { retryConfig, trackUrl } = GLOBAL_TRACK_CONFIG;\n    const retryableTracks = failedTracks.filter(track => {\n        const currentRetryCount = track.retryCount || 0;\n        const timeCondition = force || Date.now() - track.retryTime >= retryConfig!.initialDelay * Math.pow(retryConfig!.delayMultiplier, currentRetryCount);\n        return currentRetryCount < retryConfig!.maxRetryTimes && timeCondition;\n    });\n\n    if (retryableTracks.length === 0) return;\n\n    for (const track of retryableTracks) {\n        try {\n            // 使用全局配置的 trackUrl\n            await fetch(trackUrl, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    ...track,\n                    timestamp: Date.now(),\n                    userAgent: navigator.userAgent,\n                    url: window.location.href,\n                    referrer: document.referrer,\n                    retryCount: (track.retryCount || 0) + 1\n                })\n            });\n            console.log('埋点重试成功：', track.eventName);\n            const index = failedTracks.findIndex(t => t.retryTime === track.retryTime && t.eventName === track.eventName);\n            if (index > -1) failedTracks.splice(index, 1);\n        } catch (error) {\n            console.error('埋点重试失败：', track.eventName, error);\n            const index = failedTracks.findIndex(t => t.retryTime === track.retryTime && t.eventName === track.eventName);\n            if (index > -1) {\n                failedTracks[index].retryCount = (failedTracks[index].retryCount || 0) + 1;\n                failedTracks[index].retryTime = Date.now();\n            }\n        }\n    }\n\n    saveFailedTracks(failedTracks);\n};\n\n/**\n * 通用埋点发送函数（支持单个 Hook 覆盖 trackUrl）\n * @param params 埋点参数\n * @param config 单个 Hook 的配置（可覆盖 trackUrl）\n */\nconst sendTrack = async (params: TrackParams, config: TrackConfig) => {\n    if (!params.eventName) {\n        console.warn('埋点缺少必要参数：eventName');\n        return;\n    }\n\n    // 优先级：单个 Hook 配置 > 全局配置\n    const finalTrackUrl = config.trackUrl || GLOBAL_TRACK_CONFIG.trackUrl;\n    const isEnable = config.enable ?? GLOBAL_TRACK_CONFIG.enable;\n\n    if (!isEnable) return;\n\n    try {\n        // 使用最终确定的 trackUrl 发送请求\n        await fetch(finalTrackUrl, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                ...params,\n                timestamp: Date.now(),\n                userAgent: navigator.userAgent,\n                url: window.location.href,\n                referrer: document.referrer\n            })\n        });\n        console.log('埋点上报成功：', params);\n\n        if (window.requestIdleCallback) {\n            window.requestIdleCallback(() => retryFailedTracks(), { timeout: 2000 });\n        } else {\n            setTimeout(() => retryFailedTracks(), 1000);\n        }\n    } catch (error) {\n        console.error('埋点上报失败：', error);\n        const failedTracks = getFailedTracks();\n        failedTracks.push({ ...params, retryTime: Date.now(), retryCount: 0 });\n        saveFailedTracks(failedTracks);\n    }\n};\n\n// ---------------------- 核心 Hooks 实现 ----------------------\nexport const useTrack = (params: TrackParams, config: TrackConfig = {}) => {\n    // 合并默认配置（含全局配置）和单个 Hook 配置\n    const mergedConfig = { ...getMergedDefaultConfig(), ...config };\n    const trackRef = useRef(params);\n\n    useEffect(() => {\n        trackRef.current = params;\n    }, [params]);\n\n    const triggerTrack = useCallback((customParams = {}) => {\n        const finalParams = {\n            ...trackRef.current,\n            ...customParams\n        };\n        // 把 mergedConfig 传给 sendTrack，支持覆盖 trackUrl\n        sendTrack(finalParams, mergedConfig);\n    }, [mergedConfig]);\n\n    return { triggerTrack };\n};\n\nexport const useTrackClick = (\n    eventName: string,\n    customParams: Record<string, any> = {},\n    config: TrackConfig = {}\n) => {\n    const { triggerTrack } = useTrack(\n        { eventName, type: TrackType.CLICK, ...customParams },\n        config\n    );\n\n    const handleClick = useCallback((e?: React.MouseEvent, extraParams = {}) => {\n        const clickParams = { clientX: e?.clientX || 0, clientY: e?.clientY || 0, ...extraParams };\n        triggerTrack(clickParams);\n    }, [triggerTrack]);\n\n    return handleClick;\n};\n\nexport const useTrackExposure = <T extends HTMLElement = HTMLElement>(\n    eventName: string,\n    customParams: Record<string, any> = {},\n    config: TrackConfig = {}\n) => {\n    const mergedConfig = { ...getMergedDefaultConfig(), ...config };\n    const { triggerTrack } = useTrack(\n        { eventName, type: TrackType.EXPOSURE, ...customParams },\n        mergedConfig\n    );\n\n    const targetRef = useRef<T>(null);\n    const hasReported = useRef(false);\n\n    useEffect(() => {\n        if (!mergedConfig.enable) return;\n\n        const observer = new IntersectionObserver(\n            (entries) => {\n                entries.forEach((entry) => {\n                    if (entry.isIntersecting && !hasReported.current) {\n                        const exposureParams = {\n                            intersectionRatio: entry.intersectionRatio,\n                            boundingClientRect: entry.boundingClientRect,\n                            exposureTime: Date.now()\n                        };\n                        triggerTrack(exposureParams);\n\n                        if (mergedConfig.exposureOnce) {\n                            hasReported.current = true;\n                            observer.unobserve(entry.target);\n                        }\n                    }\n                });\n            },\n            { threshold: mergedConfig.exposureThreshold }\n        );\n\n        const target = targetRef.current;\n        if (target) observer.observe(target);\n\n        return () => {\n            if (target) observer.unobserve(target);\n            observer.disconnect();\n        };\n    }, [mergedConfig, triggerTrack]);\n\n    return targetRef;\n};\n\nexport const useTrackPageStay = (\n    eventName: string,\n    customParams: Record<string, any> = {},\n    config: TrackConfig = {}\n) => {\n    const { triggerTrack } = useTrack(\n        { eventName, type: TrackType.PAGE_STAY, ...customParams },\n        config\n    );\n\n    const startTime = useRef(Date.now());\n\n    useEffect(() => {\n        const handleVisibilityChange = () => {\n            if (document.hidden) {\n                const stayTime = Date.now() - startTime.current;\n                triggerTrack({ stayTime });\n            } else {\n                startTime.current = Date.now();\n            }\n        };\n\n        const handleBeforeUnload = () => {\n            const stayTime = Date.now() - startTime.current;\n            triggerTrack({ stayTime });\n        };\n\n        document.addEventListener('visibilitychange', handleVisibilityChange);\n        window.addEventListener('beforeunload', handleBeforeUnload);\n\n        return () => {\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\n            window.removeEventListener('beforeunload', handleBeforeUnload);\n        };\n    }, [triggerTrack]);\n};\n\nexport const useTrackCustom = (\n    eventName: string,\n    customParams: Record<string, any> = {},\n    config: TrackConfig = {}\n) => {\n    const { triggerTrack } = useTrack(\n        { eventName, type: TrackType.CUSTOM, ...customParams },\n        config\n    );\n\n    return triggerTrack;\n};\n\nexport const useTrackRetryListener = () => {\n    useEffect(() => {\n        const initTimer = setTimeout(() => retryFailedTracks(), 3000);\n\n        const handleVisibilityChange = () => {\n            if (!document.hidden) {\n                retryFailedTracks();\n            }\n        };\n        document.addEventListener('visibilitychange', handleVisibilityChange);\n\n        let idleCallbackId: number | null = null;\n        const checkIdleRetry = () => {\n            retryFailedTracks();\n            idleCallbackId = window.requestIdleCallback(checkIdleRetry, { timeout: 30000 });\n        };\n        if (window.requestIdleCallback) {\n            idleCallbackId = window.requestIdleCallback(checkIdleRetry, { timeout: 30000 });\n        }\n\n        return () => {\n            clearTimeout(initTimer);\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\n            if (idleCallbackId !== null && window.cancelIdleCallback) {\n                window.cancelIdleCallback(idleCallbackId);\n            }\n        };\n    }, []);\n};"],"names":["TrackType","useRef","useEffect","useCallback"],"mappings":"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"}